#!/bin/bash

if [ ! "$1" == "in-session" ]
then
  tmux new-session -d -s rails-ide
fi

# Set default panes
tmux split-window -v

# Run default commands
tmux send-keys -t 0 "vi" C-m

if [ -f config.ru ]
then
  # Setup rails server pane
  if [ "$1" == "with-zeus" ]
  then
    tmux split-window -v
    tmux send-keys -t 2 "zeus start" C-m
    tmux split-window -v
    tmux send-keys -t 3 "zeus server" C-m
  else
    tmux split-window -v
    tmux send-keys -t 3 "bundle exec rails server" C-m
  fi
fi

# Set layout
tmux select-layout main-horizontal
tmux resize-pane -D 25
tmux select-pane -t 0

if [ ! "$1" == "in-session" ]
then
  #tmux select-window -t rails-ide:1
  tmux -2 attach-session -t rails-ide
fi
